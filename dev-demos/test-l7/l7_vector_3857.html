<!--********************************************************************
* Copyright© 2000 - 2023 SuperMap Software Co.Ltd. All rights reserved.
*********************************************************************-->
<!--********************************************************************
* 该示例需要引入 
* G6 (https://github.com/antvis/G6)
*********************************************************************-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>vector</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100vh;
        overflow: hidden;
      }
      #map {
        width: 100%;
        height: 100%;
      }
      button {
        position: relative;
        z-index: 111;
      }
    </style>
      <link rel="stylesheet" type="text/css" href="..//iclient-mapboxgl.css"></link>
      <script type="text/javascript" src="https://iclient.supermap.io/web/libs/mapbox-gl-js-enhance/1.12.1-3/mapbox-gl-enhance.js"></script>
      <script type="text/javascript" src="../../mapboxgl-l7-render/dist/index.js"></script> <!-- l7-mapboxgl -->
      <script type="text/javascript" src="..//iclient-mapboxgl-es6.js"></script>
  </head>

  <body>
    <button >clickme</button>
    <div id="map"></div>
    <script type="text/javascript">
       var host = 'http://172.16.14.44:8090';
      var attribution =
        "<a href='https://www.mapbox.com/about/maps/' target='_blank'>© Mapbox </a>" +
        " with <span>© <a href='https://iclient.supermap.io' target='_blank'>SuperMap iClient</a> | </span>" +
        " Map Data <span>© <a href='http://support.supermap.com.cn/product/iServer.aspx' target='_blank'>SuperMap iServer</a></span> ";

      var tileURL = host + '/iserver/services/map-china400/rest/maps/ChinaDark/zxyTileImage.png?z={z}&x={x}&y={y}';
      var map = new mapboxgl.Map({
        container: 'map',
        style: {
          version: 8,
          sources: {
            'raster-tiles': {
              attribution: attribution,
              type: 'raster',
              tiles: [tileURL],
              tileSize: 256
            }
          },
          layers: [
            {
              id: 'simple-tiles',
              type: 'raster',
              source: 'raster-tiles',
              minzoom: 0,
              maxzoom: 22
            }
          ]
        },
        center: [112, 32.24997445586331],
        zoom: 5
      });

      

      map.on('load', function (map) {
        createMvtLayer(map)
      });
      function createMvtLayer(map) {
        const url = 'https://mvt.amap.com/district/CHN2/{z}/{x}/{y}/4096?key=309f07ac6bc48160e80b480ae511e1e9&version=';
          const source = new L7.Source(url, {
            parser: {
              type: 'mvt',
              tileSize: 256,
              warp: false
            }
          });
          const colors = {};
          const GDPSpeed = {
            520000: 10, //贵州
            540000: 10, //西藏
            530000: 8.5, //云南
            500000: 8.5, //重庆
            360000: 8.5, //江西
            340000: 8.0, //安徽
            510000: 7.5, //四川
            350000: 8.5, //福建
            430000: 8.0, //湖南
            420000: 7.5, //湖北
            410000: 7.5, //河南
            330000: 7.0, //浙江
            640000: 7.5, //宁夏
            650000: 7.0, //新疆
            440000: 7.0, //广东
            370000: 7.0, //山东
            450000: 7.3, //广西
            630000: 7.0, //青海
            320000: 7.0, //江苏
            140000: 6.5, //山西
            460000: 7, // 海南
            310000: 6.5, //上海
            110000: 6.5, // 北京
            130000: 6.5, // 河北
            230000: 6, // 黑龙江
            220000: 6, // 吉林
            210000: 6.5, //辽宁
            150000: 6.5, //内蒙古
            120000: 5, // 天津
            620000: 6, // 甘肃
            610000: 8.5, // 甘肃
            710000: 6.64, //台湾
            810000: 6.0, //香港
            820000: 6.7 //澳门
          };
          const getColorByDGP = function (adcode) {
            if (!colors[adcode]) {
              const gdp = GDPSpeed[adcode];
              if (!gdp) {
                colors[adcode] = 'rgb(227,227,227)';
              } else {
                const rg = 255 - Math.floor(((gdp - 5) / 5) * 255);
                colors[adcode] = 'rgb(' + rg + ',' + rg + ',255)';
              }
            }
            return colors[adcode];
          };
          var fill = new mapboxgl.supermap.L7Layer({ type: 'PolygonLayer', options: { sourceLayer: 'CHN_Cities' } });
          fill.getL7Layer().source(source).shape('fill').color('adcode_pro', getColorByDGP);

          var line = new mapboxgl.supermap.L7Layer({ type: 'LineLayer', options: { sourceLayer: 'CHN_Cities_L' } });
          line.getL7Layer().source(source).shape('line').color('#FFA500');

          var line2 = new mapboxgl.supermap.L7Layer({ type: 'LineLayer', options: { sourceLayer: 'CHN_L' } });
          line2.getL7Layer().source(source).shape('line').size(0.6).color('#053061');

          var line3 = new mapboxgl.supermap.L7Layer({
            type: 'PointLayer',
            options: { sourceLayer: 'CHN_Cities', blend: 'normal' }
          });
          line3.getL7Layer().source(source).shape('id', 'text').size(12).color('#000');

          // map.addLayer(fill);
          // map.addLayer(line);
          // map.addLayer(line2);
          // map.addLayer(line3);
      }
    
    </script>
  </body>
</html>
